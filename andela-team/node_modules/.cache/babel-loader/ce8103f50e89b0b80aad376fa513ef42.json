{"ast":null,"code":"import _regeneratorRuntime from\"/Users/user/Documents/GitHub/natfinest-react.github.io/andela-team/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/user/Documents/GitHub/natfinest-react.github.io/andela-team/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{createSlice}from\"@reduxjs/toolkit\";import url from\"../components/config\";import axios from\"axios\";import*as JWT from\"jwt-decode\";var token=localStorage.getItem(\"user\")?JSON.parse(localStorage.getItem(\"user\")).user.token:null;if(token){if(JWT(token).exp<Date.now()/1000){localStorage.removeItem(\"user\");}}var initialUser=localStorage.getItem(\"user\")?JSON.parse(localStorage.getItem(\"user\")):null;export var initialState={user:initialUser,error:\"\",loading:\"\",hasErrors:\"\"};// A slice of user with our reducers\nvar slice=createSlice({name:\"user\",initialState:initialState,reducers:{loginSuccess:function loginSuccess(state,action){state.hasErrors=false;state.user=action.payload;localStorage.setItem(\"user\",JSON.stringify(action.payload));},loginFailure:function loginFailure(state,action){state.error=action.payload;state.hasErrors=true;},registerSuccess:function registerSuccess(state,action){state.hasErrors=false;state.user=action.payload;localStorage.setItem(\"user\",JSON.stringify(action.payload));},registerFailure:function registerFailure(state,action){state.error=action.payload;state.hasErrors=true;},logoutSuccess:function logoutSuccess(state){state.hasErrors=false;state.user=null;localStorage.removeItem(\"user\");}}});// Three actions generated from the slice\nvar _slice$actions=slice.actions,loginSuccess=_slice$actions.loginSuccess,loginFailure=_slice$actions.loginFailure,registerSuccess=_slice$actions.registerSuccess,registerFailure=_slice$actions.registerFailure,logoutSuccess=_slice$actions.logoutSuccess;// A selector\nexport{loginSuccess,loginFailure,registerSuccess,registerFailure,logoutSuccess};export var userSelector=function userSelector(state){return state.user;};// The reducer\nexport default slice.reducer;// Asynchronous thunk action\nexport var login=function login(_ref){var username=_ref.username,password=_ref.password;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:axios.post(\"\".concat(url,\"/api/v1/auth/signin\"),{email:username,password:password}).then(function(response){var _response$data$data=response.data.data,firstname=_response$data$data.firstname,email=_response$data$data.email,id=_response$data$data.id,token=_response$data$data.token;var user={firstname:firstname,email:email,id:id,token:token};dispatch(loginSuccess({user:user}));}).catch(function(error){error=error.response.data.error;dispatch(loginFailure({error:error}));});case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}();};export var register=function register(_ref3){var form_firstname=_ref3.form_firstname,form_lastname=_ref3.form_lastname,form_email=_ref3.form_email,form_password=_ref3.form_password,form_gender=_ref3.form_gender,form_jobrole=_ref3.form_jobrole,form_department=_ref3.form_department,form_address=_ref3.form_address,form_avatarurl=_ref3.form_avatarurl,form_userrole=_ref3.form_userrole;return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:axios.post(\"\".concat(url,\"/api/v1/auth/create-user\"),{firstname:form_firstname,lastname:form_lastname,email:form_email,password:form_password,gender:form_gender,jobrole:form_jobrole,department:form_department,address:form_address,avatarurl:form_avatarurl,userrole:form_userrole}).then(function(response){var _response$data$data2=response.data.data,firstname=_response$data$data2.firstname,email=_response$data$data2.email,id=_response$data$data2.id,token=_response$data$data2.token;var user={firstname:firstname,email:email,id:id,token:token};dispatch(registerSuccess({user:user}));}).catch(function(err){var error=err.response.data.error;dispatch(registerFailure({error:error}));});case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref4.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;return _context3.abrupt(\"return\",dispatch(logoutSuccess()));case 4:_context3.prev=4;_context3.t0=_context3[\"catch\"](0);return _context3.abrupt(\"return\",console.error(_context3.t0.message));case 7:case\"end\":return _context3.stop();}}},_callee3,null,[[0,4]]);}));return function(_x3){return _ref5.apply(this,arguments);};}();};","map":{"version":3,"sources":["/Users/user/Documents/GitHub/natfinest-react.github.io/andela-team/src/slices/user.js"],"names":["createSlice","url","axios","JWT","token","localStorage","getItem","JSON","parse","user","exp","Date","now","removeItem","initialUser","initialState","error","loading","hasErrors","slice","name","reducers","loginSuccess","state","action","payload","setItem","stringify","loginFailure","registerSuccess","registerFailure","logoutSuccess","actions","userSelector","reducer","login","username","password","dispatch","post","email","then","response","data","firstname","id","catch","register","form_firstname","form_lastname","form_email","form_password","form_gender","form_jobrole","form_department","form_address","form_avatarurl","form_userrole","lastname","gender","jobrole","department","address","avatarurl","userrole","err","logout","console","message"],"mappings":"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","sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\nimport url from \"../components/config\";\nimport axios from \"axios\";\nimport * as JWT from \"jwt-decode\";\n\nconst token = localStorage.getItem(\"user\")\n  ? JSON.parse(localStorage.getItem(\"user\")).user.token\n  : null;\nif (token) {\n  if (JWT(token).exp < Date.now() / 1000) {\n    localStorage.removeItem(\"user\");\n  }\n}\n\nconst initialUser = localStorage.getItem(\"user\")\n  ? JSON.parse(localStorage.getItem(\"user\"))\n  : null;\nexport const initialState = {\n  user: initialUser,\n  error: \"\",\n  loading: \"\",\n  hasErrors: \"\",\n};\n\n// A slice of user with our reducers\nconst slice = createSlice({\n  name: \"user\",\n  initialState,\n  reducers: {\n    loginSuccess: (state, action) => {\n      state.hasErrors = false;\n      state.user = action.payload;\n      localStorage.setItem(\"user\", JSON.stringify(action.payload));\n    },\n    loginFailure: (state, action) => {\n      state.error = action.payload;\n      state.hasErrors = true;\n    },\n    registerSuccess: (state, action) => {\n      state.hasErrors = false;\n      state.user = action.payload;\n      localStorage.setItem(\"user\", JSON.stringify(action.payload));\n    },\n    registerFailure: (state, action) => {\n      state.error = action.payload;\n      state.hasErrors = true;\n    },\n    logoutSuccess: (state) => {\n      state.hasErrors = false;\n      state.user = null;\n      localStorage.removeItem(\"user\");\n    },\n  },\n});\n\n// Three actions generated from the slice\nexport const {\n  loginSuccess,\n  loginFailure,\n  registerSuccess,\n  registerFailure,\n  logoutSuccess,\n} = slice.actions;\n\n// A selector\nexport const userSelector = (state) => state.user;\n\n// The reducer\nexport default slice.reducer;\n\n// Asynchronous thunk action\nexport const login = ({ username, password }) => async (dispatch) => {\n  axios\n    .post(`${url}/api/v1/auth/signin`, {\n      email: username,\n      password: password,\n    })\n    .then((response) => {\n      const { firstname, email, id, token } = response.data.data;\n      const user = { firstname, email, id, token };\n      dispatch(loginSuccess({ user }));\n    })\n    .catch((error) => {\n      error = error.response.data.error;\n      dispatch(loginFailure({ error }));\n    });\n};\n\nexport const register = ({\n  form_firstname,\n  form_lastname,\n  form_email,\n  form_password,\n  form_gender,\n  form_jobrole,\n  form_department,\n  form_address,\n  form_avatarurl,\n  form_userrole,\n}) => async (dispatch) => {\n  axios\n    .post(`${url}/api/v1/auth/create-user`, {\n      firstname: form_firstname,\n      lastname: form_lastname,\n      email: form_email,\n      password: form_password,\n      gender: form_gender,\n      jobrole: form_jobrole,\n      department: form_department,\n      address: form_address,\n      avatarurl: form_avatarurl,\n      userrole: form_userrole,\n    })\n    .then((response) => {\n      const { firstname, email, id, token } = response.data.data;\n      const user = { firstname, email, id, token };\n      dispatch(registerSuccess({ user }));\n    })\n    .catch((err) => {\n      const error = err.response.data.error;\n      dispatch(registerFailure({ error }));\n    });\n};\n\nexport const logout = () => async (dispatch) => {\n  try {\n    return dispatch(logoutSuccess());\n  } catch (e) {\n    return console.error(e.message);\n  }\n};\n"]},"metadata":{},"sourceType":"module"}